{
  "hash": "a2f1955d7ded3ff01640a53585f85a4a",
  "result": {
    "markdown": "---\ntitle: \"Explorations in Pediatric Drug Safety\"\nsubtitle: \"montelukast-associated systematic disorders\"\nimage: \"images/explore.png\"\nimage-alt: \"dGAM signal distribution for montelukast associated Psychiatric disorders across child development stages\"\ndate: \"12/29/2022\"\ndate-format: \"MMMM D, YYYY\"\npage-layout: article\ntoc: true\ncomments:\n  utterances:\n    repo: ngiangre/quarto_site\n---\n\n\nIn this post, I am looking into something that I have been wanting to look into for a while. This short notebook shows a mini investigation into work I did during my PhD. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'data.table'\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n\nThe following object is masked from 'package:purrr':\n\n    transpose\n```\n:::\n\n```{.r .cell-code}\ntheme_set(theme_bw())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nPDSdatabase::download_sqlite_db()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/nickgiangreco/Library/Caches/org.R-project.R/R/PDSdatabase/effect_peds_19q2_v0.3_20211119.sqlite already exists!\n```\n:::\n\n```{.r .cell-code}\ncon <- PDSdatabase::connect_sqlite_db()\n```\n:::\n\n\nIn this notebook, I want to investigate more into a claim I made in my [paper](https://doi.org/10.1016/j.medj.2022.06.001) on pediatric drug safety:\n\n> We investigate the relationship between development stage and known pediatric drug effects, such as montelukast-induced psychiatric disorders, where we found a significant signal (odds ratio 8.77 \\[2.51, 46.94\\]) within the second year of life.\n\nNow I'm not disputing this claim, I actually have this enrichment in the database I created:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl(con,\"ade_nichd_enrichment\") %>% \n    filter(nichd==\"toddler\" &\n               atc_concept_name==\"montelukast\" &\n               meddra_concept_name==\"Psychiatric disorders\") %>% \n    collect()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 15\n  category atc_con…¹ meddr…² nichd atc_c…³ meddr…⁴     a     b     c     d   lwr\n  <chr>    <chr>     <chr>   <chr> <chr>   <chr>   <int> <int> <int> <int> <dbl>\n1 soc_atc5 monteluk… Psychi… todd… ATC5    SOC        16  6777     3 11145  2.51\n# … with 4 more variables: odds_ratio <dbl>, upr <dbl>, pvalue <dbl>,\n#   fdr <dbl>, and abbreviated variable names ¹​atc_concept_name,\n#   ²​meddra_concept_name, ³​atc_concept_class_id, ⁴​meddra_concept_class_id\n```\n:::\n:::\n\n\nThe odds of 8.7708426 indicates a large association of statistically significant reporting of montelukast-induced Psychiatric disorders for toddlers.\n\nBut, these statistics were generated using a null threshold declaring significance. I'm interested to evaluate montelukast and Psychiatric disorders having larger signal at a particular stage. Here's my visualizations to attempt to evaluate this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmontelukast_drug_info <- tbl(con,\"drug\") %>%\ncollect() %>%\nfilter(grepl(\"montelukast\",atc_concept_name))\n\npsych_disorder_ids <- tbl(con,\"event\") %>%\ncollect() %>%\nfilter(grepl(\"Psych\",meddra_concept_name_4)) %>%\npluck('meddra_concept_id')\n\npos <- \n    position_dodge2(width=0.1)\n\ntbl(con,\"ade_nichd\") %>% \n    filter(atc_concept_id==!!pluck(montelukast_drug_info,\"atc_concept_id\") &\n               meddra_concept_id %in% !!psych_disorder_ids) %>% \n    collect() %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd))\n    ) %>% \n    ggplot(aes(nichd,gam_score_90mse)) +\n    geom_violin() +\n    geom_point(pch=21,size=0.2,\n               position = pos) +\n    geom_line(aes(group=ade),alpha=0.1,\n              position = pos) +\n    geom_point(\n        data=tbl(con,\"ade_null\") %>% \n            collect(),\n        aes(nichd,null_99),\n        size=3,color=\"red\",\n               position = pos) +\n    theme(\n        axis.text.x = element_text(angle=45,vjust=1,hjust=1)\n    ) +\n    labs(x=\"\",y=\"90% lower dGAM signal\",caption = \"99% null dGAM in red\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nprobs <- seq(0,1,0.01)\ntbl(con,\"ade_nichd\") %>% \n    filter(atc_concept_id==!!pluck(montelukast_drug_info,\"atc_concept_id\") &\n               meddra_concept_id %in% !!psych_disorder_ids) %>% \n    collect() %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd))\n    ) %>% \n    group_by(nichd) %>% \n    summarise(q = list(probs),\n              qs = \n                  list(quantile(gam_score_90mse,probs = probs))\n              ) %>% \n    unnest(c(\"qs\",\"q\")) %>% \n    ggplot(aes(nichd,q,fill=qs)) +\n    geom_tile() +\n    scale_y_continuous(labels = scales::percent,\n                       breaks = scales::pretty_breaks(6)) +\n    scale_fill_gradient2(low = \"purple\",\n                         midpoint = 1,high = \"red\") +\n    labs(y=\"Signal Percentile in stage\",x=\"\") +\n    guides(fill=guide_colorbar(title=\"dGAM lower\\n90% CI signal\")) +\n    theme(\n        axis.text.x = element_text(angle=45,vjust=1,hjust=1)\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nprobs <- seq(0.8,1,0.01)\ntbl(con,\"ade_nichd\") %>% \n    filter(atc_concept_id==!!pluck(montelukast_drug_info,\"atc_concept_id\") &\n               meddra_concept_id %in% !!psych_disorder_ids) %>% \n    collect() %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd))\n    ) %>% \n    group_by(nichd) %>% \n    summarise(q = list(probs),\n              qs = \n                  list(quantile(gam_score_90mse,probs = probs))\n              ) %>% \n    unnest(c(\"qs\",\"q\")) %>% \n    left_join(\n        tbl(con,\"ade_null\") %>% \n            collect(),\n        by=\"nichd\"\n    ) %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd)),\n        above_null_99 = qs>null_99\n    ) %>% \n    ggplot(aes(nichd,q,fill=above_null_99)) +\n    geom_tile() +\n    scale_y_continuous(labels = scales::percent,\n                       breaks = scales::pretty_breaks(6)) +\n    scale_fill_brewer(palette = \"Set1\",direction = -1) +\n    labs(y=\"Signal Percentile in stage\",x=\"\") +\n    theme(\n        axis.text.x = element_text(angle=45,vjust=1,hjust=1)\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\nFrom these, we can see how there are large, outlier scores for montelukast induced Psychiatric disorders at the toddler stage. The score distributions are similar across toddler and childhood stages, though. Nevertheless, the last graph shows that the signals in the toddler stage are above the null 99% scores in a larger proportion of the signal distribution. So empirically, we do see that montelukast-induced Psychiatric disorders are more likely (i.e. have larger, nonrandom signal) at the toddler stage of child development.\n\nSince the last graph is the most definitive graph showing localization of non-random signal for this systematic disorder, we can create the graph for all montelukast-induced systematic disorders in order to evaluate non-random signal at stages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndisorders <- \n    tbl(con,\"event\") %>%\n    collect() %>% \n    pull(meddra_concept_name_4) %>% \n    na.omit() %>% \n    unique()\n\npos <- \n    position_dodge2(width=0.1)\nprobs <- seq(0.8,1,0.01)\ncolors <- RColorBrewer::brewer.pal(3,\"Set1\")[1:2]\nnames(colors) <- c(\"TRUE\",\"FALSE\")\n\ng_objs <- lapply(disorders,function(disorder){\n    disorder_ids <- \n    tbl(con,\"event\") %>%\n    collect() %>%\n    filter(meddra_concept_name_4==disorder) %>%\n    pluck('meddra_concept_id')\n    \n    tbl(con,\"ade_nichd\") %>% \n    filter(atc_concept_id==!!pluck(montelukast_drug_info,\"atc_concept_id\") &\n               meddra_concept_id %in% !!disorder_ids) %>% \n    collect() %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd))\n    ) %>% \n    group_by(nichd) %>% \n    summarise(q = list(probs),\n              qs = \n                  list(quantile(gam_score_90mse,probs = probs))\n              ) %>% \n    unnest(c(\"qs\",\"q\")) %>% \n    left_join(\n        tbl(con,\"ade_null\") %>% \n            collect(),\n        by=\"nichd\"\n    ) %>% \n    mutate(\n        nichd = factor(nichd,levels=unique(nichd)),\n        above_null_99 = qs>null_99\n    ) %>% \n    ggplot(aes(nichd,q,fill=above_null_99)) +\n    geom_tile(show.legend = F) +\n    scale_y_continuous(labels = scales::percent,\n                       breaks = scales::pretty_breaks(6)) +\n    scale_fill_manual(values=colors) +\n    labs(y=\"\",x=\"\",title=\"\",subtitle=disorder) +\n    theme(\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank()\n    )\n})\n\nnames(g_objs) <- disorders\n\ncowplot::plot_grid(plotlist=g_objs,ncol = 5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=1920}\n:::\n:::\n\n\nYou can see that few systematic disorders had higher-than-the-null signal at stages. Psychiatric disorders do seem to be uniquely induced in toddlers by montelukast.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPDSdatabase::disconnect_sqlite_db(con)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}